# Autofill Service

An autofill service is an app that makes it easier for users to fill out forms by injecting data into the views of other apps. Autofill service can also retrieve user data from the views in an app and store it to use it at a later time. Autofill service are usually provided by apps that manage user data, such as password managers.

Android makes filling out forms easier with the autofill framework available in Android 8.0 (API level 26) and higher. Users can take advantage of autofill features only if there is an app that provides autofill service on their device.

This page shows how to implement an autofill service in your titanium app. A good source of knowledge is [this page on medium.com](https://medium.com/@bherbst/getting-androids-autofill-to-work-for-you-21435debea1)


## Architecture
The manifest of your Axway's Titanium app (provider) contains the service entry (described below). This entry causes that this special app appears in this system dialog after clicking of `+ Add service`.  

<img src="https://4.bp.blogspot.com/-lVe8xrfcdeI/Wgy9BY13hRI/AAAAAAAAEzg/GCVosf8ahRYovP_w4vPZIA_CILqC0_e7wCLcBGAs/s1600/image1.png" width=200 />

After installing and activating you can use it in a second app. This second app (consumer) can now use this form field entries generated by first app.

<img src="https://cdn-images-1.medium.com/max/1920/1*LzBqZgcsK9IoVmZQFGhhXA.gif"  width=200 />

For controling the behaviour the Ti.UI.Textfield has a new property [autofillType](https://docs.appcelerator.com/platform/latest/#!/api/Titanium.UI.TextField-property-autofillType). Possible values are:

* Ti.UI.AUTOFILL\_TYPE\_USERNAME
* Ti.UI.AUTOFILL\_TYPE\_PASSWORD

etc.

The selection of autofill repo is only possible in system configuration (dialog above) or in you first app with commmand `requestAutofill()`. The consumer app (second app) cannot select.



## Manifest declarations and permissions	
Ensute that this is part of you manifest. It will automatically inserted by module.

```xml
<service
    android:name="de.appwerft.autofillservice.TiAutofillService"
    android:label="Forghetty"
    android:permission="android.permission.BIND_AUTOFILL_SERVICE">
    <intent-filter>
        <action android:name="android.service.autofill.AutofillService" />
    </intent-filter>
</service>
```
## Prompt to enable the service  

An app is used as the autofill service after it declares the BIND_AUTOFILL_SERVICE permission and the user enables it in the device settings. An app can verify if it's the currently enabled service by calling the hasEnabledAutofillService() method of the module.

```js
const AutoFill = require('de.appwerft.autofillservice');
const res = Autofill.hasEnabledAutofillService();
if (!res) {
    Autofill.onResult = function(e) {
        if (e.success==true) {
            //
        }
    }
    AutoFill.requestAutofillService();
}
```

If the app isn't the current autofill service, then it can request the user to change the autofill settings by using the ACTION_REQUEST_SET_AUTOFILL_SERVICE intent. The intent returns a RESULT_OK value if the user selected an autofill service that matches the package of the caller.

## Methods of module

### isAutofillSupported()
Returns true if autofill is supported by the current device and is supported for this user. 
### hasEnabledAutofillService()
Returns true if the calling application provides a AutofillService that is enabled for the current user, or false otherwise. 

### isEnabled()

Checks whether autofill is enabled for the current user. 
### requestAutofill()
Explicitly requests a new autofill context for virtual views. 

	
### disableAutofillService()
If the app calling this API has enabled autofill service they will be disabled. 
### cancel()
Called to indicate the current autofill context should be cancelled.

This method is typically called by View that manage virtual views; for example, when the view is rendering an HTML page with a form and virtual views that represent the HTML elements, it should call this method if the user does not post the form but moves to another form in this page.

Note: This method does not need to be called on regular application lifecycle methods such as Activity.finish().
### commit()
Called to indicate the current autofill context should be commited.

This method is typically called by View that manage virtual views; for example, when the view is rendering an HTML page with a form and virtual views that represent the HTML elements, it should call this method after the form is submitted and another page is rendered.

Note: This method does not need to be called on regular application lifecycle methods such as Activity.finish().
### getAutofillServiceComponentName() : String
Returns the component name of the AutofillService that is enabled for the current user. 

### getDefaultFieldClassificationAlgorithm() : String
Gets the name of the default algorithm used for field classification. 
### getAvailableFieldClassificationAlgorithms(): Strings[]
Gets the name of all algorithms currently available for field classification. 
### getNextAutofillId() : AutofillId
Gets the next unique autofill ID for the activity context. 
### getUserData() : UserData


### onResult 

```js
Autofill.onResult= function(e) {
	switch (e.code) {
		case Autofill.RESULT_OK:
		break;
		case Autofill.RESULT_CANCELED:
		break;
	}
}
```



